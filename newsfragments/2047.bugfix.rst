Improve client/server handshake mechanism