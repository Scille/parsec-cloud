.. Parsec Cloud (https://parsec.cloud) Copyright (c) BUSL-1.1 2016-present Scille SAS

.. _doc_userguide_mfa:

Multi-factor authentication (MFA)
==================================

Parsec supports **Multi-factor authentication (MFA)** as an optional additional layer of
protection for your device. When enabled, logging in requires both your usual credential
(e.g. password or OS keyring) and a confirmation from a second source — a one-time code
generated by an **authenticator application** on your phone (e.g. `Aegis <https://getaegis.app/>`_,
`Google Authenticator <https://support.google.com/accounts/answer/1066447>`_,
or any `TOTP-compatible <https://en.wikipedia.org/wiki/Time-based_one-time_password>`_ app).

Why enable MFA?
---------------

Without MFA, your device credentials are stored entirely on your machine. This means
that if your computer is stolen, an attacker in possession of the device could
potentially attempt to recover your credentials offline, without the Parsec server
ever being involved.

With MFA enabled, the Parsec server is required during login: it must validate the
one-time code before releasing the secret needed to unlock your device. This means
**a stolen machine alone is not enough** — the attacker would also need access to your
authenticator app.

Trade-off: MFA requires a server connection at login
------------------------------------------------------

Enabling MFA changes the login process so that it **requires a connection to the
Parsec server**. This is both a security benefit and a usability trade-off:

- **Security benefit**: An offline attacker (e.g. someone who stole your laptop)
  cannot access your data without also having your authenticator app.
- **Usability trade-off**: You can no longer log in while completely offline (e.g.
  with no network access at all). A slow or intermittent connection (e.g. on a train)
  is fine, but extended periods without any connectivity make login impossible.

.. note::

   The server connection is only required **during login**. Once you are logged in,
   Parsec continues to work normally even if connectivity is lost. You can read and
   modify files in your workspaces without an active server connection.

How to enable MFA
-----------------

You can enable MFA from your profile page.

1. Install a TOTP-compatible authenticator app on your phone
   (e.g. `Aegis <https://getaegis.app/>`_,
   `Google Authenticator <https://support.google.com/accounts/answer/1066447>`_,
   or any `TOTP-compatible <https://en.wikipedia.org/wiki/Time-based_one-time_password>`_ app).

2. In Parsec, click on your name on the main menu (top-right) and go to your profile
   settings.

3. In the MFA section, click **Enable MFA** to start the setup.

4. Parsec will display a QR code (or a secret key for manual entry). Scan it with your
   authenticator app to add the account.

5. Enter the 6-digit code shown in your authenticator app to confirm the setup.

MFA is now active. The next time you log in on this device, Parsec will prompt you for
a one-time code before unlocking your device.

.. caution::

   Once MFA is set up, the same authenticator entry is used for **all devices** you
   protect with MFA in this organization. Do not delete it from your authenticator app
   unless you have first disabled MFA on all your devices.

Logging in with MFA
--------------------

When MFA is enabled on a device:

1. Select your device in the Parsec login screen.
2. Parsec prompts you for the 6-digit code from your authenticator app.
3. Enter the code (it changes every 30 seconds — use the current one).
4. Parsec then prompts for your usual credential (eg. password or OS keyring).
5. You are now logged in.

Recovering access when the authenticator app is lost
-----------------------------------------------------

If you lose access to your authenticator app (e.g. lost or replaced phone), you will
not be able to log in to any device protected with MFA. In this situation, you need to
request a **MFA setup reset** from your **server administrator**.

See :ref:`doc_hosting_mfa_reset` for the command the server administrator must run.

What to do after the reset
~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the server administrator has performed the reset:

1. Check your email for a message from Parsec with the subject
   *"Your MFA has been reset for <organization>"*.
2. Click the link in the email (or open the link provided by your administrator).
   This opens Parsec and starts the MFA reconfiguration flow.
3. A new QR code is displayed. Scan it with your authenticator app (on your new
   phone or a freshly installed app) to re-register the account.
4. Confirm the setup by entering the 6-digit code shown in the app.

MFA is now re-configured and you can log in again normally.

.. note::

   The reset only changes the secret shared between your authenticator app and the
   server. Your existing devices and all your data remain intact — nothing is lost.
