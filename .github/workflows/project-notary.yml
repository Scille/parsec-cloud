# Add new issue & pull request to a project.
name: project-notary

on:
  workflow_dispatch:

env:
  project-number: 2
  project-orga: scille

jobs:
  add-issue-to-project:
    runs-on: ubuntu-22.04
    steps:
      - name: Debug tool version
        run: |
          set -x
          gh --version
          jq --version
          base64 --version

      - name: List issues & PR with the wrong/missing project
        run: |
          echo -n '' > issues_wrong_project.json

          for type in issue pr; do
            gh $type list \
              --json id,title,number \
              --search '-project:"${{ env.project-orga }}/${{ env.project-number }}"' \
              --jq ".[] += {\"type\": \"$type\"} | .[]" \
              | tee -a issues_wrong_project.json
          done

          jq '. | @base64' issues_wrong_project.json > issues_wrong_project.json.b64
