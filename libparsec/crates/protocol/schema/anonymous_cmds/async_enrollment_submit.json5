[
    {
        "major_versions": [
            5
        ],
        "cmd": "async_enrollment_submit",
        "req": {
            "fields": [
                {
                    // UUID of the current request, generated by the sender.
                    "name": "enrollment_id",
                    "type": "AsyncEnrollmentID"
                },
                {
                    // Allow to submit a new request for a given email to replace a pending one.
                    "name": "force",
                    "type": "Boolean"
                },
                {
                    // `AsyncEnrollmentSubmitPayload` serialized in msgpack format.
                    // Must check `submit_payload_signature` before loading it!
                    "name": "submit_payload",
                    "type": "Bytes"
                },
                {
                    "name": "submit_payload_signature",
                    "type": "SubmitPayloadSignature"
                }
            ]
        },
        "reps": [
            {
                // The request was accepted by the server and need to be reviewed by an organization admin.
                "status": "ok",
                "fields": [
                    {
                        "name": "submitted_on",
                        "type": "DateTime"
                    }
                ]
            },
            {
                // An enrollment request already exists for the requested email in the submit payload.
                "status": "email_already_submitted",
                "fields": [
                    {
                        "name": "submitted_on",
                        "type": "DateTime"
                    }
                ]
            },
            {
                // A (non-revoked) user already exists for the requested email in the submit payload.
                "status": "email_already_enrolled"
            },
            {
                "status": "id_already_used"
            },
            {
                // `submit_payload` field doesn't correspond to a valid `AsyncEnrollmentSubmitPayload`
                "status": "invalid_submit_payload"
            },
            {
                // `submit_payload_signature` doesn't match with `submit_payload`
                "status": "invalid_submit_payload_signature"
            },
            {
                // A provided X509 certificate (either the submitter's or an intermediate) is invalid
                "status": "invalid_der_x509_certificate"
            },
            {
                // Cannot trust provided trustchain.
                // This usually means the trustchain is technically valid, but
                // it relies on a X509 root certificate that is not among the
                // ones trusted by the server.
                "status": "invalid_x509_trustchain"
            }
        ],
        "nested_types": [
            {
                "name": "SubmitPayloadSignature",
                "discriminant_field": "type",
                "variants": [
                    {
                        "name": "PKI",
                        "discriminant_value": "PKI",
                        "fields": [
                            {
                                "name": "signature",
                                "type": "Bytes"
                            },
                            {
                                "name": "algorithm",
                                "type": "PkiSignatureAlgorithm"
                            },
                            {
                                // The certificate used by the submitter to sign the request.
                                "name": "submitter_der_x509_certificate",
                                "type": "Bytes"
                            },
                            {
                                // Optional list of intermediate certificates needed to
                                // validate the certificate chain from `submitter_der_x509_certificate`
                                // up to the root certificate.
                                // Also note that both accepter and submitter must share the
                                // same root certificate for the validation to succeed.
                                "name": "intermediate_der_x509_certificates",
                                "type": "List<Bytes>"
                            }
                        ]
                    },
                    {
                        "name": "OpenBao",
                        "discriminant_value": "OPEN_BAO",
                        "fields": [
                            {
                                // Signature returned by OpenBao using API at
                                // `<openbao_server_url>/v1/transit/sign/entity-<submitter_openbao_entity_id>`
                                //
                                // Note this is a string, as OpenBao speaks JSON and its signatures typically looks something like:
                                // `vault:v1:C4jRZx+ymLou26tN8Q2KDy46dA47W7x/MH6nuEZVqdz+H0RvoaFbQUAHceBKhB+Qow2qXAXiRFAFWKGPZU93CQ==`
                                "name": "signature",
                                "type": "String"
                            },
                            {
                                // Key used for signature verification is located at
                                // `<openbao_server_url>/v1/transit/verify/entity-<submitter_openbao_entity_id>`
                                //
                                // Note once the signature verification is done, the submitter's
                                // email can be obtained from OpenBao using API at
                                // `<openbao_server_url>/v1/identity/entity/id/<submitter_openbao_entity_id>`.
                                //
                                // This is important at the submitter email must match with the
                                // email specified in the `AsyncEnrollmentSubmitPayload`!
                                "name": "submitter_openbao_entity_id",
                                "type": "String"
                            }
                        ]
                    }
                ]
            }
        ]
    }
]
