parameters:
  - name: cargo_home_dir
    type: string
    default: $(HOME)/.cargo
  - name: cargo_target_dir
    type: string
    default: ./target
  - name: cache_version
    type: number
    default: 1

steps:
  - task: Cache@2
    inputs:
      key: '"cargo-target" | "${{ variables.cache_version }}" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-target | "${{ variables.cache_version }}" | "$(Agent.OS)"
        cargo-target | "${{ variables.cache_version }}"
        cargo-target
      path: ${{ parameters.cargo_target_dir }}
    displayName: Cache cargo target

  - task: Cache@2
    inputs:
      key: '"cargo-git" | "${{ variables.cache_version }}" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-git | "${{ variables.cache_version }}" | "$(Agent.OS)"
        cargo-git | "${{ variables.cache_version }}"
        cargo-git
      path: ${{ parameters.cargo_home_dir }}/git/db
    displayName: Cache cargo git database

  - task: Cache@2
    inputs:
      key: '"cargo-registry-index" | "${{ variables.cache_version }}" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-registry-index | "${{ variables.cache_version }}" | "$(Agent.OS)"
        cargo-registry-index | "${{ variables.cache_version }}"
        cargo-registry-index
      path: ${{ parameters.cargo_home_dir }}/registry/index
    displayName: Cache cargo index registry

  - task: Cache@2
    inputs:
      key: '"cargo-registry-cache" | "${{ variables.cache_version }}" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-registry-cache | "${{ variables.cache_version }}" | "$(Agent.OS)"
        cargo-registry-cache | "${{ variables.cache_version }}"
        cargo-registry-cache
      path: ${{ parameters.cargo_home_dir }}/registry/cache
    displayName: Cache cargo cache registry
