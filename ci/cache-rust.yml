parameters:
  - name: cargo_home_dir
    type: string
    default: $(HOME)/.cargo
  - name: cargo_target_dir
    type: string
    default: ./target

steps:
  - task: Cache@2
    inputs:
      key: '"cargo-target" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-target | "$(Agent.OS)"
        cargo-target
      path: $(cargo_target_dir)
    displayName: Cache cargo target

  - task: Cache@2
    inputs:
      key: '"cargo-git" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-git | "$(Agent.OS)"
        cargo-git
      path: $(cargo_home_dir)/git/db
    displayName: Cache cargo git database

  - task: Cache@2
    inputs:
      key: '"cargo-registry-index" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-registry-index | "$(Agent.OS)"
        cargo-registry-index
      path: $(cargo_home_dir)/registry/index
    displayName: Cache cargo index registry

  - task: Cache@2
    inputs:
      key: '"cargo-registry-cache" | "$(Agent.OS)" | Cargo.lock'
      restoreKeys: |
        cargo-registry-cache | "$(Agent.OS)"
        cargo-registry-cache
      path: $(cargo_home_dir)/registry/cache
    displayName: Cache cargo cache registry
